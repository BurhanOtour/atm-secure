#!/usr/bin/env python2
import socket
import argparse
import sys
import requests


def send(server, port):
  v = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
  v.connect((server, port))
  v.send(b'99999999999999999\n')
  v.close()

def end_test(commandserver_url):
  requests.post(commandserver_url, data={"REQUEST": '{"type": "done"}'})

if __name__ == '__main__':
  parser = argparse.ArgumentParser(description='Send')
  parser.add_argument('-p', type=int, default=4000, help="listen port")
  parser.add_argument('-s', type=str, default="127.0.0.1", help="server ip address")
  parser.add_argument('-q', type=int, default=3000, help="server port")
  parser.add_argument('-c', type=str, default="127.0.0.1", help="command server")
  parser.add_argument('-d', type=int, default=5000, help="command port")
  args = parser.parse_args()
  commandserver_url = "http://"+args.c+":"+str(args.d)+"/"
  print('started\n')
  sys.stdout.flush()

  try:
    send(args.s, args.q)
  finally:
    end_test(commandserver_url)

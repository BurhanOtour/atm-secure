import okio.Buffer;

public class LoggingInterceptor implements Interceptor {

    private final ThreadLocal<Buffer> bufferThreadLocal = ThreadLocal.withInitial(Buffer::new);

    @Override public InterceptionResult serverToClient(byte[] bytes) {
        Buffer buffer = bufferThreadLocal.get();
        buffer.clear();
        buffer.write(bytes);
        String md5 = buffer.md5().hex();

        System.err.println("Sending " + bytes.length + " bytes to client. (MD5=" + md5 + ")");
        return new InterceptionResult(true, bytes);
    }

    @Override public InterceptionResult clientToServer(byte[] bytes) {
        Buffer buffer = bufferThreadLocal.get();
        buffer.clear();
        buffer.write(bytes);
        String md5 = buffer.md5().hex();

        System.err.println("Sending " + bytes.length + " bytes to server. (MD5=" + md5 + ")");
        return new InterceptionResult(true, bytes);
    }

    @Override public boolean shouldAcceptNextSocket() {
        return true;
    }
}

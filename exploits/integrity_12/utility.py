#!/usr/bin/python3

import os.path
import random, string

# Constants
SECRET_KEY = os.getenv('SECRET_KEY', 'VERY STRONG KEY.')
FILE_ENCRYPTIO_ENABLE = os.getenv('FILE_ENCRYPTIO_ENABLE', 0)

if FILE_ENCRYPTIO_ENABLE:
    from Crypto.Cipher import AES


# Return a random secret
def generate_random_secret(length=5):
    return ''.join(random.SystemRandom().choice(string.ascii_uppercase + string.digits) for _ in range(length))


# Write given message (encrpted) to given file
def write_to_file(file_name, message):
    if FILE_ENCRYPTIO_ENABLE:
        encrypter = AES.new(SECRET_KEY, AES.MODE_CFB, 'This is an IV456')
        ciphertext = encrypter.encrypt(message)

        with open(file_name, 'wb') as f:
            f.write(ciphertext)
    else:
        with open(file_name, 'w') as f:
            f.write(message)


# Read message (dencrpted) from given file
def read_from_file(file_name):
    if FILE_ENCRYPTIO_ENABLE:
        ciphertext = None
        decrypter = AES.new(SECRET_KEY, AES.MODE_CFB, 'This is an IV456')

        with open(file_name, 'rb') as f:
            ciphertext = f.read()

        return decrypter.decrypt(ciphertext).decode()

    message = ''

    with open(file_name, 'r') as f:
        message = f.read()

    return message